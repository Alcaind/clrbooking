"use strict";var globalVars=angular.module("GlobalVarsSrvs",["ApiModules","ngCookies","MainComponents","pascalprecht.translate"]);globalVars.factory("globalVarsSrv",["$http","$cookies","$window","api","$translate",function(t,e,a,n,o){function i(t,e){b[t]||(b[t]=[]),b[t].push(e)}function l(t){return m[t]}function r(t,e){if(b[t])for(var a=0;a<b[t].length;a++){var n=b[t][a];n(e,m[t])}m[t]=e}function f(t){m[t].delete()}function s(t){m=Object.assign(m,t),c()}function u(e,a){t.get("config/appConfig.json").then(function(t){s(t.data),o.use(t.data.lang),a&&a(),m.appStarted=!0},function(t){console.log(t|JSON)})}function c(){l("auth")&&(a.localStorage["appConf"+l("auth").username]=JSON.stringify(m))}function d(t,e){var n=a.localStorage["appConf"+t];if(t===l("auth").username)return m=n?Object.assign(m,JSON.parse(n)):m,o.use(m.lang),e&&e(),m.appStarted=!0,m}function p(t,e,a){d(e,a)&&m.appUrl||u(t,a)}function g(t,e){var a=t.getTime();if(e.getTime()-a<864e5){var n=a+864e5;return e=new Date(n)}return e}var m={appStarted:!1},b=[];return{getGlobalVar:l,setGlobalVar:r,removeGlobalVar:f,setGlobal:s,initFromFile:u,appInit:p,cookieGet:d,cookieSave:c,addListener:i,checkDates:g}}]),globalVars.factory("makeController",["globalVarsSrv","api","orderByFilter","$routeParams","MakeModal","AuthenticationService",function(t,e,a,n,o,i){function l(n,l,r){i.CheckCredentials();var f={dp:[],baseURL:t.getGlobalVar("appUrl")+n,totalRows:0,tableColumns:t.getGlobalVar(l),title:r,operations:t.getGlobalVar(l+"Ops"),url:n};return f.operations.map(function(t){t.ifVisible=!0}),f.selectedRow=null,f.setUrl=function(e){f.url=e,f.baseURL=t.getGlobalVar("appUrl")+e},f.getAll=function(t){t?e.apiCall("GET",t,function(t){f.dp=[],f.dp=t.data,f.totalRows=f.dp.length}):e.apiCall("GET",f.baseURL,function(t){f.dp=[],f.dp=t.data,f.totalRows=f.dp.length})},f.ifDelete="delete"===t.getGlobalVar("token").scope[3],f.selectRow=function(t){f.selectedRow&&(f.selectedRow.selected=!1),t.selected=!0,f.selectedRow=t},f.delete=function(t){e.apiCall("DELETE",f.baseURL+"/"+t.id,function(e){f.dp.splice(f.dp.indexOf(t),1),o.generalInfoModal("sm","Info","info","Eπιτυχής διαγραφή",1)})},f.init=function(){f.cth=f.tableColumns[0],f.cth.sorted=!0,f.getAll()},f.cth={},f.sortBy=function(t){f.cth===t?f.cth.reverse=!f.cth.reverse:(f.cth.sorted=!1,t.sorted=!0,f.cth=t),f.dp=a(f.dp,f.cth.column,f.cth.reverse)},f.filter=[],f.filterValue=[],f.filterJson=function(t){var e=(JSON.stringify(t).toLowerCase(),!1),a=0;for(var n in f.filterValue)a++,""===f.filterValue[n]&&(a--,delete f.filterValue[n]),f.filterValue[n]&&t[n]&&(e="string"==typeof f.filterValue[n]?JSON.stringify(t[n]).toLowerCase().indexOf(f.filterValue[n].toLowerCase())>-1:JSON.stringify(t[n]).indexOf(f.filterValue[n])>-1);return 0===a||e},f.clearFilters=function(){f.filterValue=[]},f}function r(a,l,r){function f(t){t.map(function(t){t.pivot.fromt&&(t.pivot.fromt=new Date("1970-01-01 "+t.pivot.fromt),t.pivot.tot=new Date("1970-01-01 "+t.pivot.tot))})}var s={ldp:[],rdp:[],lLength:0,rLength:0,pivotData:null,pivotTable:r,currentRight:{},baseURL:t.getGlobalVar("appUrl")+a,mainData:{}};return s.init=function(){i.CheckCredentials(),s.getMain(),s.getLeft(),s.getRight()},s.getMain=function(){e.apiCall("GET",s.baseURL+"/"+n.id,function(t){s.mainData=t.data})},s.getLeft=function(){e.apiCall("GET",s.baseURL+"/"+n.id+"/"+l,function(t){s.ldp=t.data,s.lLength=s.ldp.length,s.rdp&&s.rdp.length>0&&s.compare(s.ldp,s.rdp),f(s.ldp)})},s.getRight=function(){e.apiCall("GET",t.getGlobalVar("appUrl")+"/"+l,function(t){s.rdp=t.data,s.rLength=s.rdp.length,s.ldp&&s.ldp.length>0&&s.compare(s.ldp,s.rdp)})},s.editPivotData=function(t){s.currentRight=t,s.pivotData=t.pivot,s.state=1},s.deleteData=function(t){e.apiCall("DELETE",s.baseURL+"/"+n.id+"/"+l+"/"+t,function(t){s.ldp=t.data,s.compare(s.ldp,s.rdp),f(s.ldp)},void 0,t)},s.showPivotData=function(t){s.pivotData=Object.assign(s.pivotTable),s.state=0,s.currentRight=t},s.compare=function(t,e){for(var a=0;a<e.length;a++){e[a].disabled=!1;for(var n=0;n<t.length;n++)angular.equals(e[a].id,t[n].id)&&(e[a].disabled=!0)}},s.cancelPivotData=function(){s.pivotData=null,s.currentRight=null},s.insertPivotItem=function(t){var a="PUT";0===s.state&&(a="POST"),t.fromt&&(t.fromt=t.fromt.getMinutes()<10?t.fromt.getHours()+":0"+t.fromt.getMinutes()+":00":t.fromt.getHours()+":"+t.fromt.getMinutes()+":00",t.tot=t.tot.getMinutes()<10?t.tot.getHours()+":0"+t.tot.getMinutes()+":00":t.tot.getHours()+":"+t.tot.getMinutes()+":00"),e.apiCall(a,s.baseURL+"/"+n.id+"/"+l+"/"+s.currentRight.id,function(e){t={comment:"",status:"1"},s.ldp=e.data,s.compare(s.ldp,s.rdp),f(s.ldp),s.cancelPivotData(),o.generalInfoModal("sm","Info","Info",0===s.state?"Δημιουργήθηκε νέα εγγραφή.":"Η εγγραφή ανανεώθηκε.",1)},void 0,t)},s}function f(a,i){function l(t){t.fromd&&("string"==typeof t.fromd?t.fromd=new Date(t.fromd):t.fromd=new Date(t.fromd.getTime()-6e4*t.fromd.getTimezoneOffset()),"string"==typeof t.tod?t.tod=new Date(t.tod):t.tod=new Date(t.tod.getTime()-6e4*t.tod.getTimezoneOffset()))}var r={item:{},baseURL:t.getGlobalVar("appUrl")+a,tableColumns:t.getGlobalVar(i)};return r.init=function(){n.id?e.apiCall("GET",r.baseURL+"/"+n.id,function(t){r.item=t.data}):r.tableColumns.map(function(t){r.item[t.column]=""})},r.save=function(t){l(t),e.apiCall("POST",r.baseURL,function(t){o.generalInfoModal("sm","Info","Info","Δημιουργήθηκε νέα εγγραφή.",1),history.back()},void 0,t)},r.update=function(t){e.apiCall("PUT",r.baseURL+"/"+t.id,function(t){o.generalInfoModal("sm","Info","info","Η εγγραφή ανανεώθηκε.",1),history.back()},void 0,t)},r}return{mainController:l,n2nController:r,profileController:f}}]);