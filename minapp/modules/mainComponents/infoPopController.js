angular.module("MainComponents").directive("infoFormPopUp",function(){return{restrict:"EA",scope:{reqID:"="},templateUrl:"modules/mainComponents/views/infoFormPopUp.html",controller:"infoFormPopUpController"}}).controller("infoFormPopUpController",["$scope","globalVarsSrv","$uibModalInstance","api","config","$location","MakeModal","AuthenticationService",function(e,t,s,o,a,r,n,i){var u=t.getGlobalVar("appUrl");e.reqID=a.reqID,e.ps=[],e.toConfigReq=[],e.showddps=!0,e.tmExists=!1,e.weekOptions=t.getGlobalVar("weekdaysTableDateIndex"),e.cancel=function(){s.close("cancel")},e.ok=function(){var t={};if(!0===e.flag&&!1===e.showddps&&"undefined"!==e.requests.ps_id&&null!=e.requests.ps_id){e.requests.status=e.requests.status?0:e.requests.status,e.requests.ps_id=e.currentPs.id,e.requests.pivot=[];for(var a=0;a<e.requests.rooms.length;a++){e.requests.rooms[a].date_index=e.requests.rooms[a].pivot.date_index;var r={comment:e.requests.rooms[a].pivot.comment?e.requests.rooms[a].pivot.comment:null,date_index:e.requests.rooms[a].pivot.date_index,fromt:e.requests.rooms[a].pivot.fromt,teacher:e.requests.rooms[a].pivot.teacher?e.requests.rooms[a].pivot.teacher:null,tot:e.requests.rooms[a].pivot.tot};e.requests.pivot.push(r),e.requests.rooms[a].pivot.id===e.mainData.id&&(e.requests.rooms[a].teacher=e.mainData.teacher,r.teacher=e.mainData.teacher)}o.apiCall("PUT","api/public/requests/userrequest",function(o){n.generalInfoModal("sm","info","","Το αίτημά σας καταχωρήθηκε με επιτυχία.",1),t.type=0,t.data=e.currentPs,s.close(JSON.stringify(t))},void 0,e.requests),e.flag=0}else t.type=0===e.flag?1:2,t.data=0===e.flag?e.currentPs:"ok",s.close(JSON.stringify(t))},e.delete=function(e){o.apiCall("DELETE","api/public/requests/"+e.id,function(e){n.generalInfoModal("sm","info","","Το αίτημά σας διαγράφηκε με επιτυχία.",1),s.close('{"type":3}')})},e.cancel=function(){s.dismiss("cancel")},e.mailTo=function(e){window.open("mailto:"+e.em_main)},e.mailTm=function(e){window.open("mailto:"+e.users.em_main)},e.adminReq=function(e){r.path("/requests/"+e),s.close()},e.currentPs={},e.flag=!1,e.$watch("currentPs",function(t){e.flag=!0,t.id&&(e.requests.ps_id=t.id,o.apiCall("GET","api/public/ps/"+t.id+"/users",function(t){e.teachers=t.data}))}),e.getPop=function(){u="api/public","/publicroombook"===r.url()&&(u="api/public",o.apiCall("GET",u+"/publicroombook/"+e.reqID,function(t){e.mainData=t.data,e.requests={status:0},o.apiCall("GET",u+"/requests/"+e.mainData.req_id,function(t){e.requests=t.data})}));var s=t.getGlobalVar("auth");e.requests={},o.apiCall("GET",u+"/roombook/"+e.reqID,function(t){e.mainData=t.data,e.tmExists=!1,s.authdata.roles[0].tm.map(function(t){t.id===e.mainData.requests.tm_id&&(e.tmExists=!0)}),e.requests={},o.apiCall("GET",u+"/requests/"+e.mainData.req_id,function(t){e.requests=t.data,e.requests.showTod=new Date(e.requests.tod)-new Date(e.requests.fromd)>864e5,5===e.requests.status&&e.tmExists&&(o.apiCall("GET",u+"/ps/user/"+s.authdata.roles[0].id+"/config/"+e.requests.conf_id,function(t){e.ps=t.data},void 0,s.authdata.roles[0].tm),o.apiCall("GET",u+"/teacher",function(t){e.teachers=t.data}),e.showddps=!1)})}),e.showddps=!0},e.auth=t.getGlobalVar("auth"),e.uAdmin=function(){if(e.auth){for(var t=0,s=0;s<e.auth.authdata.roles[0].roles.length;s++)if(4===e.auth.authdata.roles[0].roles[s].id)return t++,!0;if(1!==t)return!1}}(),e.getPop()}]).directive("ngEnter",function(e){return{scope:{ngEnter:"&"},link:function(t,s,o){var a=function(s){13===s.which&&(t.ngEnter(),t.$apply(),console.log("ENTER"),s.preventDefault(),e.unbind("keydown keypress",a))};e.bind("keydown keypress",a)}}});