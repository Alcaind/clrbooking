"use strict";angular.module("Rooms",["MainComponents","ui.bootstrap","ApiModules","Authentication","GlobalVarsSrvs"]).controller("RoomsController",["$scope","AuthenticationService","makeController","globalVarsSrv","api","MakeModal","ClrStatusSrv",function(o,t,e,i,r,l,a){t.CheckCredentials(),o.ctrl=e.mainController("/rooms","roomsTableConf","Κατάλογος Αιθουσών"),o.ctrl.init(),o.statusOptions={},o.itemtypes=[],o.itemtype=[],o.roomDP=[],o.statusOptions=a.getStatus("roomStatus"),o.deleteUsage=function(t,e){r.apiCall("DELETE","api/public/rooms/"+t.id+"/usages/"+e.id,function(i){o.ctrl.dp[o.ctrl.dp.indexOf(t)].room_use.splice(o.ctrl.dp[o.ctrl.dp.indexOf(t)].room_use.indexOf(e),1),l.generalInfoModal("sm","Info","info","Eπιτυχής διαγραφή",1)})},o.$watch("ctrl.dp",function(t){o.ctrl.dp.map(function(t){o.roomDP.push(t)})}),o.userview=!0,i.getGlobalVar("auth").authdata.roles[0].roles.map(function(t){4===t.id&&(o.userview=!1)}),r.apiCall("GET","api/public/itemtype",function(t){o.itemtypes=t.data}),o.roomItemsModal=function(){l.generalModal("modules/mainComponents/views/generalModal.html","sm","info","Επιλογή εξοπλισμού",o.itemtypes,2,function(t){o.itemtype=t,o.filterRooms(o.roomDP,o.ctrl.dp,t)})},o.filterRooms=function(t,e,i){for(;o.roomDP.length>0;)o.roomDP.pop();for(var r=0,l=0;l<o.itemtype.length;l++)o.itemtype[l].visible&&r++;e.map(function(t){for(var e=!1,i=0,l=0;l<t.items.length;l++){for(var a=0;a<o.itemtype.length;a++)t.items[l].id===o.itemtype[a].id&&o.itemtype[a].visible&&i++;i===r&&(e=!0)}!e&&r||o.roomDP.push(t)})}}]).controller("RoomProfileController",["$scope","$routeParams","api","MakeModal","AuthenticationService","makeController","globalVarsSrv","ClrStatusSrv",function(o,t,e,i,r,l,a,s){o.ctrl=l.profileController("/rooms","roomsTableConf"),o.statusOptions={},o.statusOptions=s.getStatus("roomStatus"),o.ctrl.init(),o.categories=[],o.roomusages=[],o.configs=[],o.tms=[],o.selectedUsages=[],o.multiSelectOptions={displayProp:"synt"},e.apiCall("GET","api/public/roomcategory",function(t){o.categories=t.data}),e.apiCall("GET","api/public/config",function(t){o.configs=t.data}),e.apiCall("GET","api/public/roomuse",function(t){o.roomusages=t.data,o.roomusages.forEach(function(o){o.label=o.synt})}),e.apiCall("GET","api/public/tms",function(t){var e=[],i=[];t.data.map(function(o){e.indexOf(o.descr)<0&&(e.push(o.descr),i.push(o))}),o.tms=i})}]).component("roomProfile",{restrict:"EA",templateUrl:"modules/rooms/rviews/rprofile.html",scope:{method:"="},controller:"RoomProfileController"});