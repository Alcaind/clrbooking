"use strict";angular.module("Authentication",["angular-storage","GlobalVarsSrvs"]).factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","store","jwtHelper","$location","globalVarsSrv",function(e,t,a,r,o,n,l,i){var d={};return d.Login=function(e,a,r){var l=window.location.href.split("/"),u=l[3],s={method:"POST",headers:{Authorization:d.SetCredentials(e,a)},url:"./api/public/login",data:{user:e,password:a,app:u}};t(s).then(function(e){o.set("jwt",e.data),o.set("rwt",n.decodeToken(e.data.token)["refresh-token"]);var t={};t.username=n.decodeToken(o.get("jwt").token).sub,t.authdata=n.decodeToken(o.get("jwt").token),i.setGlobalVar("auth",t),r(e)},function(e){r(e),console.log(e.status)})},d.SetCredentials=function(t,a){return"Basic "+e.encode(t+":"+a)},d.ClearCredentials=function(){var e={};e.username=n.decodeToken(o.get("jwt").token).sub,e.authdata="",i.setGlobalVar("auth",e),i.setGlobalVar("menuRole",null),o.set("jwt",null),o.set("rwt",null),t.defaults.headers.common.Authorization="Basic ",l.path("/login")},d.CheckCredentials=function(){var e=o.get("jwt")&&"undefined"!=o.get("jwt").token?o.get("jwt").token:null;o.get("rwt")&&"undefined"!=o.get("rwt").token&&o.get("rwt").token;if(!e||n.isTokenExpired(e))return l.path("/login"),!1;var t={};if(t.username=n.decodeToken(e).sub,t.authdata=n.decodeToken(e),i.setGlobalVar("auth",t),i.setGlobalVar("token",t.authdata),t.authdata.roles)for(var a=0;a<t.authdata.roles[0].roles.length;a++){if("admin"===t.authdata.roles[0].roles[a].role){i.setGlobalVar("menuRole","admin");break}i.setGlobalVar("menuRole","user");var r=l.url(),d=i.getGlobalVar("homeButtonUserTableConf"),u=!1;if(d){for(a=0;a<d.length;a++)r.indexOf(d[a].column)>=0&&(u=!0);u||l.path("/home")}}return n.decodeToken(e).sub},d}]).factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var a,r,o,n,l,i="",d="",u="",s=0;do{a=t.charCodeAt(s++),r=t.charCodeAt(s++),d=t.charCodeAt(s++),o=a>>2,n=(3&a)<<4|r>>4,l=(15&r)<<2|d>>6,u=63&d,isNaN(r)?l=u=64:isNaN(d)&&(u=64),i=i+e.charAt(o)+e.charAt(n)+e.charAt(l)+e.charAt(u),a=r=d="",o=n=l=u=""}while(s<t.length);return i},decode:function(t){var a,r,o,n,l,i="",d="",u="",s=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{o=e.indexOf(t.charAt(s++)),n=e.indexOf(t.charAt(s++)),l=e.indexOf(t.charAt(s++)),u=e.indexOf(t.charAt(s++)),a=o<<2|n>>4,r=(15&n)<<4|l>>2,d=(3&l)<<6|u,i+=String.fromCharCode(a),64!=l&&(i+=String.fromCharCode(r)),64!=u&&(i+=String.fromCharCode(d)),a=r=d="",o=n=l=u=""}while(s<t.length);return i}}});