"use strict";angular.module("Users").controller("UserViewTableController",["$scope","$location","api","$uibModal","MakeModal","$translate","orderByFilter",function(e,t,s,r,a,u,i){e.weekdays=["Δ","Τρ","Τετ","Πεμ","Παρ","Σ","Κ"],e.selectRow=function(e){if(3===e.status)return void t.url("/usercreaterequests/"+e.id);if(1===e.status&&a.generalInfoModal("sm","info","Επιβεβαίωση",u.instant("Το αίτημα σας για το τμήμα:")+" "+e.tm.descr+" "+u.instant("είναι καταχωρημένο επιτυχώς "),1),1!==e.status){r.open({templateUrl:"modules/userView/userHome/popInfoPendingRequest.html",controller:"popupUserReq",size:"lg",resolve:{config:function(){return{rrID:e.id}}}})}},e.deleteDashReq=function(t,r){s.apiCall("DELETE","api/public/requests/"+t.id,function(s){e.dp.splice(e.dp.indexOf(t),1),a.generalInfoModal("sm","Info","info","Eπιτυχής διαγραφή",1)}),r.stopPropagation()},e.editDashReq=function(e,s){t.url("/usercreaterequests/"+e.id),s.stopPropagation()},e.editGuestThl=function(e){a.guestModal("modules/requests/createUserRequest/selectGuest.html","lg","info",u.instant("Παρευρισκόμενοι"),e,1)},e.propertyName="req_dt",e.reverse=!0,e.sortBy=function(t,s){e.reverse=null!==t&&e.propertyName===t&&!e.reverse,e.propertyName=t,e.dp=i(s,e.propertyName,e.reverse)},e.filterValue="",e.filterDp=[]}]).controller("UserViewController",["$scope","globalVarsSrv","ClrStatusSrv","api","$routeParams","$location","AuthenticationService","MakeModal",function(e,t,s,r,a,u,i,n){e.statusOptions=s.getStatus("requestStatus"),e.requests={},i.CheckCredentials();var o=t.getGlobalVar("auth");e.config_id=8,e.expiredRequests=[],e.canceledRequests=[],e.doneRequests=[],e.draftRequests=[],e.pendingRequests=[],e.configurationRequests=[],e.usersrequests={},t.setGlobalVar("cur",!0),r.apiCall("GET","api/public/config",function(t){e.config=t.data}),r.apiCall("GET","api/public/usersrequests/"+o.authdata.roles[0].id,function(t){e.usersrequests=t.data}),e.$watch("config_id",function(t){r.apiCall("GET","api/public/requests/users/"+o.authdata.roles[0].id+"/config/"+t,function(t){(e.requests=t.data).map(function(t){switch(t.showTod=new Date(t.tod)-new Date(t.fromd)>864e5,t.status){case 0:e.pendingRequests.push(t);break;case 1:e.doneRequests.push(t);break;case 2:e.expiredRequests.push(t);break;case 3:e.draftRequests.push(t);break;case 4:e.doneRequests.push(t);break;case 5:e.configurationRequests.push(t)}})})}),e.acceptReq=function(t,s){t.confirmType=s,t.status=1,t.to_comment=t.to_comment+" Approved",r.apiCall("PUT","api/public/usersrequests/"+t.id,function(s){e.usersrequests.splice(e.usersrequests.indexOf(t),1),n.generalInfoModal("sm","Info","info","Αποδοχή Αιτήματος",1)},void 0,t)},e.declineReq=function(t){t.status=-1,t.to_comment=t.to_comment+" decline from "+t.tousers.fname,r.apiCall("PUT","api/public/usersrequests/"+t.id,function(s){e.usersrequests.splice(e.usersrequests.indexOf(t),1),n.generalInfoModal("sm","Info","info","Άρνηση Αιτήματος",1)},void 0,t)},e.selectRRid=function(e,s){0===s.status?t.setGlobalVar("cur",!1):t.setGlobalVar("cur",!0),u.url("/usercreaterequests/"+e)},e.getstatus=function(e){switch(e.status){case 0:return"Αναμονή Έγκρισης";case 1:return"Εγκεκριμένο";case-1:return"Απορρίφθηκε"}};var l=0;e.adminConfiguration=function(){for(var e=0;e<o.authdata.roles[0].roles.length;e++)if(4===o.authdata.roles[0].roles[e].id)return l++,!1;if(0===l)return!0}}]).controller("popupUserReq",["api","$scope","$uibModalInstance","config",function(e,t,s,r){t.rrID=r.rrID,t.dataRRID=[],t.getstatus=function(e){switch(e.status){case 0:return"Αναμονή Έγκρισης";case 1:return"Εγκεκριμένο";case-1:return"Απορρίφθηκε"}},t.ok=function(){s.close("ok")},e.apiCall("GET","api/public/pendingrequests/"+t.rrID,function(e){t.dataRRID=e.data})}]).controller("guestModalController",["api","$scope","$uibModalInstance","config",function(e,t,s,r){t.item=r.data,t.item.guests=[],t.ok=function(){s.close("ok")},e.apiCall("GET","api/public/requests/"+t.item.id+"/guests",function(e){e.data&&(t.item.guests=e.data)}),t.deleteGuest=function(s){e.apiCall("DELETE","api/public/requests/guests/"+s.id,function(e){t.item.guests.splice(t.item.guests.indexOf(s),1)})},t.newGuest=function(){var e={req_id:"",name:"",uni:"",email:"",phone:"",comment:""};t.item.guests.push(e)},t.postGuest=function(s){s.req_id=t.item.id,e.apiCall("POST","api/public/request/guest",function(e){t.item.guests=e.data},void 0,s)}}]).directive("dashBoardTable",function(){return{restrict:"EA",scope:{title:"@",status:"<",dp:"="},controller:"UserViewTableController",templateUrl:"modules/userView/userHome/dashboardTable.html"}});