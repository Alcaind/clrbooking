"use strict";angular.module("Requests",["MainComponents","ui.bootstrap","ApiModules","Authentication","GlobalVarsSrvs"]).controller("RequestsController",["$scope","AuthenticationService","makeController","globalVarsSrv","ClrStatusSrv","api","MakeModal","$timeout",function(t,e,o,i,r,n,l,a){t.configs={},t.config_id=8,t.acceptShow=!0,t.$watch("config_id",function(e){e&&(t.urlr="/requests/config/"+e,t.ctrl&&t.ctrl.setUrl(t.urlr))}),n.apiCall("GET","api/public/config",function(e){t.configs=e.data,t.configs.map(function(e){1===e.status&&(t.config_id=e.id)}),t.urlr="/requests/config/"+t.config_id,t.ctrl=o.mainController("","requestsTableConf","Κατάλογος Αιτημάτων"),t.ctrl.setUrl(t.urlr),t.ctrl.init(),t.THLbutton=function(e){t.ctrl.operations[2].ifVisible=!0,7!==e.room_use.id&&(t.ctrl.operations[2].ifVisible=!1)},t.deleteRequest=function(e){n.apiCall("DELETE","api/public/requests/"+e.id,function(o){t.ctrl.dp.splice(t.ctrl.dp.indexOf(e),1),l.generalInfoModal("sm","Info","info","Eπιτυχής διαγραφή",1)})}}),t.statusOptions=i.getGlobalVar("requestStatus"),t.weekOptions=i.getGlobalVar("weekdaysTableDateIndex")}]).controller("RequestProfileController",["$scope","AuthenticationService","makeController","globalVarsSrv","$routeParams","api","$filter",function(t,e,o,i,r,n,l){function a(){t.currentLodersCnt++,t.maxLoders===t.currentLodersCnt&&t.ctrl.init()}function s(e,o){t.ctrl.item.fromd=e.fromd,t.ctrl.item.tod=e.tod,t.ctrl.item.period=e.id}t.ctrl=o.profileController("/requests","requestsTableConf"),t.users=[],t.currentLodersCnt=0,t.maxLoders=4,t.room_use=[],t.tms=[],t.ps=[],t.configs=null,t.periods=[],t.selectedPeriod={},t.statusOptions=i.getGlobalVar("requestStatus"),t.weekOptions=i.getGlobalVar("weekdaysTableDateIndex"),t.$watch("selectedPeriod",s);var c=i.getGlobalVar("auth");t.ctrl.item.admin=c.authdata.roles[0].id,t.personalTms=c.authdata.roles[0].tm,t.open1=function(){t.popup1.opened=!0},t.popup1={opened:!1},t.open2=function(){t.popup2.opened=!0},t.popup2={opened:!1},n.apiCall("GET","api/public/users",function(e){t.users=e.data,a()}),n.apiCall("GET","api/public/roomuse",function(e){t.room_use=e.data,a()}),t.$watch("ctrl.item.class_use",function(e){t.room_use.map(function(o){o.id===e&&(t.ctrl.item.priority=o.priority)})}),n.apiCall("GET","api/public/tms",function(e){t.personalTms=e.data,a()}),t.$watch("ctrl.item.conf_id",function(e){e&&t.configs&&(t.configs.map(function(o){o.id===e&&t.periods.push(o.periods)}),n.apiCall("GET","api/public/ps/config/"+e,function(e){var o=[{id:null,tm_code:null,tm_per:"---",pm:null,tma_code:null,tma_per:"---",conf_id:1}];e.data.map(function(t){o.push(t)}),t.ps=o}))}),n.apiCall("GET","api/public/config",function(e){t.configs=e.data;var o={};t.configs.map(function(e){1===e.status&&(o=e,t.periods=e.periods)}),a()})}]).component("requestsProfile",{restrict:"EA",templateUrl:"modules/requests/reqviews/profile.html",scope:{method:"="},controller:"RequestProfileController"});