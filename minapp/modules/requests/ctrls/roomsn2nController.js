angular.module("Requests").controller("RequestsRoomsController",["$scope","AuthenticationService","makeController","ClrStatusSrv","api","$routeParams","globalVarsSrv",function(t,r,e,a,o,l,i){t.ctrl=e.n2nController("/requests","rooms",{comment:"",teacher:"",fromt:"",tot:"",date_index:""}),t.ctrl.init(),t.weekOptions=i.getGlobalVar("weekdaysTableDateIndex"),t.teachers=[],o.apiCall("GET","api/public/teacher",function(r){t.teachers=r.data}),t.getTeacher=function(r){for(var e=0;e<t.teachers.length;e++)if(t.teachers[e].id===r)return t.teachers[e].sname+" "+t.teachers[e].fname},t.cancelData=function(){t.ctrl.pivotData=null,t.ctrl.currentRight=null},t.insertRoom=function(){if(0===t.ctrl.state)r="POST",t.ctrl.pivotData.fromt.setTime(t.ctrl.pivotData.fromt.getTime()-6e4*t.ctrl.pivotData.fromt.getTimezoneOffset()),t.ctrl.pivotData.tot.setTime(t.ctrl.pivotData.tot.getTime()-6e4*t.ctrl.pivotData.tot.getTimezoneOffset()),t.ctrl.pivotData.room_id=t.ctrl.currentRight.id,o.apiCall(r,"api/public/requests/"+l.id+"/rooms/"+t.ctrl.currentRight.id,function(r){t.ctrl.pivotData=Object.assign({},t.ctrl.pivotTable),t.ctrl.ldp=r.data,t.ctrl.compare(t.ctrl.ldp,t.ctrl.rdp),t.cancelData()},void 0,t.ctrl.pivotData);else{var r="PUT";t.ctrl.pivotData.room_id=t.ctrl.currentRight.id,t.ctrl.pivotData.fromt=t.ctrl.pivotData.fromt.getHours()+":"+t.ctrl.pivotData.fromt.getMinutes()+":00",t.ctrl.pivotData.tot=t.ctrl.pivotData.tot.getHours()+":"+t.ctrl.pivotData.tot.getMinutes()+":00",o.apiCall(r,"api/public/requests/rooms/"+t.ctrl.pivotData.id,function(r){t.ctrl.pivotData=Object.assign({},t.ctrl.pivotTable),t.ctrl.ldp=r.data;for(var e=0;e<t.ctrl.ldp.length;e++)t.ctrl.ldp[e].pivot.fromt&&(t.ctrl.ldp[e].pivot.fromt=new Date("1970-01-01 "+t.ctrl.ldp[e].pivot.fromt),t.ctrl.ldp[e].pivot.tot=new Date("1970-01-01 "+t.ctrl.ldp[e].pivot.tot));t.ctrl.compare(t.ctrl.ldp,t.ctrl.rdp),t.cancelData()},void 0,t.ctrl.pivotData)}}}]).directive("leftTable",function(){return{restrict:"EA",templateUrl:"modules/requests/reqviews/rooms/lTable.html"}}).directive("rightTable",function(){return{restrict:"EA",templateUrl:"modules/requests/reqviews/rooms/rTable.html"}}).directive("pivotForm",function(){return{restrict:"EA",templateUrl:"modules/requests/reqviews/rooms/pivotForm.html"}});